# 网络编程

## 爬取网站或者API

```java
<!-- https://mvnrepository.com/artifact/com.squareup.okhttp3/okhttp -->
<dependency>
 <groupId>com.squareup.okhttp3</groupId>
 <artifactId>okhttp</artifactId>
 <version>4.1.0</version>
</dependency>
```



```java
package com.youkeda.test.http;

import okhttp3.Call;
import okhttp3.OkHttpClient;
import okhttp3.Request;

import java.io.IOException;


public class GetPage {

    /**
     * 根据输入的url，读取页面内容并返回
     */
    public String getContent(String url) {
        //实例化OkHttpClient
        OkHttpClient okHttpClient = new OkHttpClient();
        //实例化一个请求，实例化Request对象，定义请求的各种参数
        Request request = new Request.Builder().url(url).build();
        //构建调用对象
        Call call = okHttpClient.newCall(request);

        // 返回结果字符串
        String result = null;
        try {
            //变化成字符串打印出来
            result = call.execute().body().string();
        } catch (IOException e) {
            System.out.println("request " + url + "error.");
            e.printStackTrace();
        }
        return result;
    }

    public static void main(String[] args) {
        GetPage getPage=new GetPage();
        String url = "https://ipservice.3g.163.com/ip";
        String content =getPage.getContent(url);

        System.out.println("API调用结果");
        System.out.println(content);
    }
}

```

## post表单

```java
package com.youkeda.test.http;

import java.io.IOException;
import java.util.Map;
import java.util.HashMap;
import okhttp3.Call;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.FormBody;
import okhttp3.FormBody.Builder;

public class FormPoster {

  public String postContent(String url, Map<String, String> formData) {
    // okHttpClient 实例
    OkHttpClient okHttpClient = new OkHttpClient();

    //post方式提交的数据
    Builder builder = new FormBody.Builder();
    // 放入表单数据
    for (String key : formData.keySet()) {
      builder.add(key, formData.get(key));
    }
    // 构建 FormBody 对象
    FormBody formBody = builder.build();
    // 指定 post 方式提交FormBody
    Request request = new Request.Builder()
            .url(url)
            // addHeader("Referer", ...) 这个知识点在后面的章节中学到，目前不要纠结
            .addHeader("Referer", "https://www.taobao.com")
            .post(formBody)
            .build();

    // 使用client去请求
    Call call = okHttpClient.newCall(request);
    // 返回结果字符串
    String result = null;
    try {
      // 获得返回结果
      result = call.execute().body().string();
    } catch (IOException e) {
      // 抓取异常
      System.out.println("request " + url + " error . ");
      e.printStackTrace();
    }
    return result;
  }

  public static void main(String[] args) {
    String url = "http://tcc.taobao.com/cc/json/mobile_tel_segment.htm";
    Map<String, String> formData = new HashMap();
    formData.put("tel", "17177466748");

    FormPoster poster = new FormPoster();
    String content = poster.postContent(url, formData);
  
    System.out.println("API调用结果");
    System.out.println(content);
  }
}

```

## POST JSON数据

```java
package com.youkeda.test.http;

import java.awt.*;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import com.alibaba.fastjson.JSON;
import okhttp3.*;

public class JsonPoster {
  private static final MediaType JSON_TYPE=MediaType.parse("application/json; charset=utf-8");
  /**
   * 向指定的 url 提交数据，以 json 的方式
   */
  public String postContent(String url, Map<String, String> datas) {
    // okHttpClient 实例
    OkHttpClient okHttpClient = new OkHttpClient();

    String param= JSON.toJSONString(datas);
    // 数据对象转换成 json 格式字符串
    RequestBody requestBody=RequestBody.create(JSON_TYPE,param);
    //post方式提交的数据
    
    Request request = new Request.Builder().url(url).post(requestBody).build();

    // 使用client去请求
    Call call = okHttpClient.newCall(request);
    // 返回结果字符串
    String result = null;
    try {
      // 获得返回结果
      result = call.execute().body().string();
    } catch (IOException e) {
      // 抓取异常
      System.out.println("request " + url + " error . ");
      e.printStackTrace();
    }
    return result;
  }

  public static void main(String[] args) {
    String url = "https://www.fastmock.site/mock/3d95acf3f26358ef032d8a23bfdead99/api/posts";
    JsonPoster poster=new JsonPoster();
    Map<String, String> data= new HashMap<>();
    data.put("num","20190101");
    data.put("name","王陆");
    data.put("gender","男");
    data.put("faculty","灵剑派");
    data.put("discipline","无相剑骨");
    data.put("class","一年一班");
    data.put("startYear","2019");
    String content = poster.postContent(url,data);

    System.out.println("API调用结果");
    System.out.println(content);
  }
}

```

